{"ast":null,"code":"var _jsxFileName = \"E:\\\\video_project\\\\client\\\\src\\\\Components\\\\Videochatroom.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from \"react\";\nimport { io } from \"socket.io-client\";\nimport { withRouter } from \"react-router-dom\"; //import createSocketConnectionInstance from \"./Connection\"\n\nimport Peer from \"peerjs\"; //import { validate as uuidValidate } from \"uuid\";\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst Videochatroom = props => {\n  _s();\n\n  // let socketInstance = useRef(null);\n  const [socket, setSocket] = useState(null);\n  const [peers, addpeers] = useState({});\n  const [mystream, setstream] = useState(null); //const [mypeer, setmypeer] = useState(\"\");\n\n  var mypeer;\n  useEffect(() => {\n    const myPeer = new Peer(undefined, {\n      host: \"/\",\n      port: \"3008\"\n    });\n    mypeer = myPeer;\n  });\n  useEffect(() => {\n    console.log(props.match.params.id);\n    console.log(\"mount it using useEffect!\");\n    const newsocket = io.connect(\"http://localhost:4000\", {\n      query: {\n        roomId: props.match.params.id\n      }\n    });\n    setSocket(newsocket);\n    const v = mypeer.call(\"7eae36c6-4a64-4e1a-936b-32d8ed6298b8\", stream);\n    mypeer.on(\"open\", id => {\n      console.log(\"user id send to join room \" + id);\n      newsocket.emit(\"join-room\", id);\n    });\n    const myVideo = document.createElement(\"video\");\n    myVideo.muted = true;\n    console.log(\"alright now \");\n    navigator.mediaDevices.getUserMedia({\n      video: true,\n      audio: true\n    }).then(stream => {\n      setstream(stream);\n      addVideoStream(myVideo, stream);\n      newsocket.on(\"user-connected\", userId => {\n        console.log(\"user id received of new user\" + userId); // connectToNewUser(userId, mystream);\n\n        setTimeout(connectToNewUser, 1000, userId, mystream);\n      });\n      newsocket.on(\"user-disconnected\", userId => {\n        if (peers[userId]) peers[userId].close();\n      });\n    }).catch(err => {\n      console.log(err);\n    });\n    mypeer.on(\"call\", call => {\n      console.log(\"someone calling\");\n      call.answer(mystream);\n      const video = document.createElement(\"video\");\n      call.on(\"stream\", userVideoStream => {\n        addVideoStream(video, userVideoStream);\n      });\n    });\n  }, []);\n\n  const connectToNewUser = (userId, stream) => {\n    console.log(\"connecting to newuser! \");\n    const call = mypeer.call(userId, stream);\n    console.log(\"cALL \" + call + \"peer \" + mypeer.id);\n    call.on(\"error\", error => {\n      console.log(error);\n    }); // adding peers\n    // console.log(\"peers adding \");\n    // addpeers((prevstate) => ({\n    //   ...prevstate,\n    //   [userId]: call,\n    // }));\n\n    const updatedValue = {};\n    updatedValue[userId] = call;\n    addpeers({ ...peers,\n      ...updatedValue\n    });\n    console.log(\"peers \", peers[userId]);\n    const video = document.createElement(\"video\");\n    call.on(\"stream\", userVideoStream => {\n      console.log(\"streaming \");\n      addVideoStream(video, userVideoStream);\n    });\n    call.on(\"close\", () => {\n      video.remove();\n    });\n  };\n\n  const addVideoStream = (video, stream) => {\n    console.log(\"adding video stream\");\n    const videoGrid = document.getElementById(\"video-grid\");\n    video.srcObject = stream;\n    video.addEventListener(\"loadedmetadata\", () => {\n      video.play();\n    });\n    videoGrid.append(video);\n    console.log(\":appending\");\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    id: \"video-grid\",\n    children: [/*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"video chat room\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"video\", {\n      children: \"Start streaming\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 123,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Videochatroom, \"b4MHyR44biFoHkIzhFnOEVCyhlc=\");\n\n_c = Videochatroom;\nexport default _c2 = withRouter(Videochatroom);\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"Videochatroom\");\n$RefreshReg$(_c2, \"%default%\");","map":{"version":3,"sources":["E:/video_project/client/src/Components/Videochatroom.js"],"names":["React","useState","useEffect","io","withRouter","Peer","Videochatroom","props","socket","setSocket","peers","addpeers","mystream","setstream","mypeer","myPeer","undefined","host","port","console","log","match","params","id","newsocket","connect","query","roomId","v","call","stream","on","emit","myVideo","document","createElement","muted","navigator","mediaDevices","getUserMedia","video","audio","then","addVideoStream","userId","setTimeout","connectToNewUser","close","catch","err","answer","userVideoStream","error","updatedValue","remove","videoGrid","getElementById","srcObject","addEventListener","play","append"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { io } from \"socket.io-client\";\r\nimport { withRouter } from \"react-router-dom\";\r\n//import createSocketConnectionInstance from \"./Connection\"\r\nimport Peer from \"peerjs\";\r\n//import { validate as uuidValidate } from \"uuid\";\r\n\r\nconst Videochatroom = (props) => {\r\n  // let socketInstance = useRef(null);\r\n  const [socket, setSocket] = useState(null);\r\n  const [peers, addpeers] = useState({});\r\n  const [mystream, setstream] = useState(null);\r\n  //const [mypeer, setmypeer] = useState(\"\");\r\n  var mypeer;\r\n\r\n  useEffect(() => {\r\n    const myPeer = new Peer(undefined, {\r\n      host: \"/\",\r\n      port: \"3008\",\r\n    });\r\n\r\n    mypeer = myPeer;\r\n  });\r\n\r\n  useEffect(() => {\r\n    console.log(props.match.params.id);\r\n    console.log(\"mount it using useEffect!\");\r\n\r\n    const newsocket = io.connect(\"http://localhost:4000\", {\r\n      query: {\r\n        roomId: props.match.params.id,\r\n      },\r\n    });\r\n    setSocket(newsocket);\r\n    const v = mypeer.call(\"7eae36c6-4a64-4e1a-936b-32d8ed6298b8\", stream);\r\n    mypeer.on(\"open\", (id) => {\r\n      console.log(\"user id send to join room \" + id);\r\n      newsocket.emit(\"join-room\", id);\r\n    });\r\n\r\n    const myVideo = document.createElement(\"video\");\r\n    myVideo.muted = true;\r\n\r\n    console.log(\"alright now \");\r\n    navigator.mediaDevices\r\n      .getUserMedia({\r\n        video: true,\r\n        audio: true,\r\n      })\r\n      .then((stream) => {\r\n        setstream(stream);\r\n        addVideoStream(myVideo, stream);\r\n\r\n        newsocket.on(\"user-connected\", (userId) => {\r\n          console.log(\"user id received of new user\" + userId);\r\n          // connectToNewUser(userId, mystream);\r\n          setTimeout(connectToNewUser, 1000, userId, mystream);\r\n        });\r\n        newsocket.on(\"user-disconnected\", (userId) => {\r\n          if (peers[userId]) peers[userId].close();\r\n        });\r\n      })\r\n      .catch((err) => {\r\n        console.log(err);\r\n      });\r\n\r\n    mypeer.on(\"call\", (call) => {\r\n      console.log(\"someone calling\");\r\n      call.answer(mystream);\r\n      const video = document.createElement(\"video\");\r\n      call.on(\"stream\", (userVideoStream) => {\r\n        addVideoStream(video, userVideoStream);\r\n      });\r\n    });\r\n  }, []);\r\n\r\n  const connectToNewUser = (userId, stream) => {\r\n    console.log(\"connecting to newuser! \");\r\n\r\n    const call = mypeer.call(userId, stream);\r\n    console.log(\"cALL \" + call + \"peer \" + mypeer.id);\r\n    call.on(\"error\", (error) => {\r\n      console.log(error);\r\n    });\r\n    // adding peers\r\n    // console.log(\"peers adding \");\r\n    // addpeers((prevstate) => ({\r\n    //   ...prevstate,\r\n    //   [userId]: call,\r\n    // }));\r\n\r\n    const updatedValue = {};\r\n    updatedValue[userId] = call;\r\n    addpeers({\r\n      ...peers,\r\n      ...updatedValue,\r\n    });\r\n    console.log(\"peers \", peers[userId]);\r\n\r\n    const video = document.createElement(\"video\");\r\n\r\n    call.on(\"stream\", (userVideoStream) => {\r\n      console.log(\"streaming \");\r\n      addVideoStream(video, userVideoStream);\r\n    });\r\n    call.on(\"close\", () => {\r\n      video.remove();\r\n    });\r\n  };\r\n\r\n  const addVideoStream = (video, stream) => {\r\n    console.log(\"adding video stream\");\r\n    const videoGrid = document.getElementById(\"video-grid\");\r\n    video.srcObject = stream;\r\n    video.addEventListener(\"loadedmetadata\", () => {\r\n      video.play();\r\n    });\r\n    videoGrid.append(video);\r\n    console.log(\":appending\");\r\n  };\r\n\r\n  return (\r\n    <div id=\"video-grid\">\r\n      <p>video chat room</p>\r\n\r\n      <video>Start streaming</video>\r\n      {/* {chatroom} */}\r\n    </div>\r\n  );\r\n};\r\nexport default withRouter(Videochatroom);\r\n"]},"metadata":{},"sourceType":"module"}