{"ast":null,"code":"var _jsxFileName = \"E:\\\\video_project\\\\client\\\\src\\\\Components\\\\Videochatroom.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from \"react\";\nimport { io } from \"socket.io-client\";\nimport { withRouter } from \"react-router-dom\";\nimport Peer from \"peerjs\"; //import { validate as uuidValidate } from \"uuid\";\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst Videochatroom = props => {\n  _s();\n\n  // let socketInstance = useRef(null);\n  const [socket, setSocket] = useState(null);\n  const [peers, addpeers] = useState({});\n  const [mypeerID, setmypeerID] = useState(\"\");\n  const [mypeer, setmypeer] = useState(\"\");\n  const [mystreams, setmystream] = useState(\"\");\n  const [mute, setmute] = useState(true);\n  const [video_icon, setvideo_icon] = useState(true);\n  const [screenshare_icon, setscreenshare_icon] = useState(false);\n  const [username, setusername] = useState(\"\");\n  useEffect(() => {\n    document.getElementById(\"comment-icon\").style.visibility = \"visible\";\n    const myPeer = new Peer(undefined, {\n      host: \"/\",\n      port: \"3008\"\n    });\n    setmypeer(myPeer);\n    let mystream = \"\"; //setmypeer(myPeer);\n\n    console.log(props.match.params.id);\n    console.log(\"mount it using useEffect!\");\n    const userName = localStorage.getItem(\"userName\");\n    setusername(userName);\n    const newsocket = io.connect(\"http://localhost:4000\", {\n      query: {\n        roomId: props.match.params.id,\n        userName\n      }\n    });\n    console.log(\"socket id \" + newsocket.id);\n    setSocket(newsocket);\n    props.setsocket(newsocket);\n    myPeer.on(\"open\", id => {\n      console.log(\"user id send to join room \" + id);\n      setmypeerID(id);\n      newsocket.emit(\"join-room\", id);\n    });\n    const myVideo = document.getElementById(\"myvideo\");\n    myVideo.muted = true;\n    console.log(\"alright now \");\n    navigator.mediaDevices.getUserMedia({\n      video: true,\n      audio: true\n    }).then(stream => {\n      mystream = stream;\n      setmystream(stream);\n      addVideoStream(myVideo, stream);\n      newsocket.on(\"user-connected\", data => {\n        console.log(\"user id received of new user\" + data.id + data.username);\n        setTimeout(connectToNewUser, 1000, data, stream, myPeer, newsocket); // connectToNewUser(userId, stream, myPeer);\n      });\n      newsocket.on(\"user-disconnected\", userId => {\n        console.log(\"userid disconnected \" + userId);\n        const disconnectedVideo = document.getElementById(userId);\n        const userdiv = document.getElementById(userId + \"a\");\n\n        if (userId) {\n          disconnectedVideo.remove();\n          userdiv.remove();\n        }\n\n        if (peers[userId]) peers[userId].close();\n      });\n      newsocket.on(\"mute-unmute\", data => {\n        if (data.id != myPeer.id) {\n          const peervideo = document.getElementById(data.id);\n          if (data.mute) peervideo.muted = true;else peervideo.muted = false;\n        }\n      });\n      newsocket.on(\"togglestream\", peerid => {\n        if (peerid != myPeer.id) {\n          console.log(\"togglestream\");\n          const peervideo = document.getElementById(peerid);\n          const stream = peervideo.srcObject;\n          const tracks = stream.getTracks();\n          tracks.forEach(track => {\n            if (track.kind == \"video\") {\n              track.stop();\n            }\n          });\n        }\n      });\n      myPeer.on(\"call\", call => {\n        console.log(\"someone calling\");\n        call.answer(stream);\n        const memberid = document.getElementById(call.peer);\n        let video = \"\";\n\n        if (memberid != null) {\n          console.log(\"member if not null \");\n          video = memberid;\n          video.muted = true;\n          call.on(\"stream\", stream => {\n            video.srcObject = stream;\n            video.play();\n          });\n          call.on(\"close\", () => {\n            console.log(\"call closing\");\n            myVideo.remove();\n          });\n        } else {\n          video = document.createElement(\"video\");\n          console.log(\"call.peer \" + call.peer);\n          video.id = call.peer;\n          video.muted = true;\n          let receivedusername = \"\";\n          newsocket.emit(\"getUsername\", call.peer);\n          newsocket.on(\"getUsername\", data => {\n            receivedusername = data;\n            console.log(\"getusername received call \" + receivedusername);\n          });\n          call.on(\"stream\", userVideoStream => {\n            addVideoStream(video, userVideoStream, receivedusername);\n          });\n          call.on(\"close\", () => {\n            console.log(\"call closing\");\n            myVideo.remove();\n          });\n        }\n      });\n    }); // return works like component will unmount\n\n    return () => {\n      newsocket.emit(\"user-disconnected\", myPeer.id);\n      newsocket.removeAllListeners();\n      mystream.getTracks().forEach(function (track) {\n        if (track.readyState == \"live\") {\n          track.stop();\n        }\n      });\n      myPeer.disconnect();\n      document.getElementById(\"comment-icon\").style.visibility = \"hidden\";\n      document.getElementById(\"chatbox\").style.display = \"none\";\n    };\n  }, []);\n\n  const connectToNewUser = async (data, stream, myPeer, socket) => {\n    console.log(\"connecting to newuser! \" + data.username); // socket.emit(\"getUsername\");\n\n    const call = await myPeer.call(data.id, stream); // adding peers flush updates\n\n    console.log(\"peers adding \");\n    addpeers(prevstate => ({ ...prevstate,\n      [data.id]: call\n    }));\n    const video = document.createElement(\"video\");\n    video.id = data.id;\n    video.className = \"peer-videos\";\n    video.muted = true;\n    console.log(\"cALL \" + call + \"peer \" + myPeer.id);\n    if (call === null || call === \"\" || call === undefined) console.log(\"null\");\n    await call.on(\"stream\", userVideoStream => {\n      console.log(\"streaming \");\n      addVideoStream(video, userVideoStream, data.username);\n    });\n  };\n\n  const addVideoStream = async (video, stream, username = \"\") => {\n    console.log(\"adding video stream with id \", video.id);\n    let div;\n    const videoGrid = document.getElementById(\"video-grid\");\n    video.srcObject = stream;\n    await video.addEventListener(\"loadedmetadata\", () => {\n      if (video.id != \"myvideo\") {\n        div = document.createElement(\"div\");\n        div.className = \"self-video\";\n        div.id = video.id + \"a\";\n        div.append(video);\n        const span = document.createElement(\"span\");\n        const fullscreen = document.createElement(\"span\");\n        span.className = \"username\";\n        span.innerHTML = username;\n        fullscreen.innerHTML = \"fullscreen\";\n        fullscreen.id = \"fullscreen\";\n        fullscreen.addEventListener(\"click\", () => {\n          alert(\"hi\");\n        });\n        div.append(span);\n        div.append(fullscreen);\n      }\n\n      video.play();\n\n      if (video.id === \"myvideo\") {} else {\n        div.className = \"notself-video\";\n        const x = document.getElementById(video.id + \"a\");\n\n        if (x != null) {\n          console.log(\"removing div\");\n          x.remove();\n        }\n\n        videoGrid.append(div);\n      }\n    });\n    console.log(\":appending\");\n  };\n\n  const muteunmute = () => {\n    const v = document.getElementById(\"myvideo\");\n    const data = {\n      id: mypeerID\n    };\n\n    if (v.muted) {\n      v.muted = false;\n      data.mute = false;\n      setmute(false);\n    } else {\n      v.muted = true;\n      data.mute = true;\n      setmute(true);\n    }\n\n    console.log(\"mute \" + mypeerID);\n    socket.emit(\"mute-unmute\", data);\n  };\n\n  const togglestream = () => {\n    console.log(\"video icon value \" + video_icon);\n    const myvideo = document.getElementById(\"myvideo\");\n    mystreams.getTracks().forEach(track => {\n      if (track.kind === \"video\") {\n        if (track.readyState == \"live\") {\n          console.log(\":true \");\n          track.stop();\n          setvideo_icon(false);\n          myvideo.src = \"\";\n          myvideo.srcObject = null;\n          socket.emit(\"togglestream\", mypeerID);\n        } else {\n          console.log(\":false\");\n          navigator.mediaDevices.getUserMedia({\n            video: true,\n            audio: true\n          }).then(stream => {\n            setmystream(stream);\n            const video = document.getElementById(\"myvideo\");\n            video.srcObject = stream;\n            video.addEventListener(\"loadedmetadata\", () => {\n              video.play();\n            });\n            socket.emit(\"getPeers\");\n            socket.on(\"getPeers\", peers => {\n              peers.forEach(peer => {\n                mypeer.call(peer, stream);\n              });\n            });\n          });\n          setvideo_icon(true);\n        }\n      }\n    });\n  };\n\n  const screenshare = () => {\n    const myvideo = document.getElementById(\"myvideo\");\n\n    if (video_icon == true || screenshare_icon == true) {\n      mystreams.getTracks().forEach(track => {\n        if (track.kind === \"video\") {\n          if (track.readyState == \"live\") {\n            console.log(\":true \");\n            track.stop();\n            setvideo_icon(false);\n            myvideo.src = \"\";\n            myvideo.srcObject = null;\n            socket.emit(\"togglestream\", mypeerID);\n          }\n        }\n      });\n    }\n\n    if (screenshare_icon == false) {\n      navigator.mediaDevices.getDisplayMedia({\n        video: true\n      }).then(stream => {\n        setmystream(stream);\n        setscreenshare_icon(true);\n        const video = document.getElementById(\"myvideo\");\n        video.srcObject = stream;\n        socket.emit(\"getPeers\");\n        socket.on(\"getPeers\", peers => {\n          peers.forEach(peer => {\n            mypeer.call(peer, stream);\n          });\n        });\n      });\n    } else {\n      setscreenshare_icon(false);\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"PEERS\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 324,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"video-main\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        class: \"self-video\",\n        children: [/*#__PURE__*/_jsxDEV(\"video\", {\n          id: \"myvideo\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 327,\n          columnNumber: 11\n        }, this), mute === true ? /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: muteunmute,\n          id: \"mute-icon\",\n          className: \"video_chat_icons\",\n          children: /*#__PURE__*/_jsxDEV(\"i\", {\n            class: \"fas fa-microphone-slash\",\n            style: {\n              fontSize: \"24px\",\n              color: \"red\"\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 335,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 330,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: muteunmute,\n          id: \"unmute-icon\",\n          className: \"video_chat_icons\",\n          children: /*#__PURE__*/_jsxDEV(\"i\", {\n            class: \"fas fa-microphone\",\n            style: {\n              fontSize: \"24px\",\n              color: \"red\"\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 346,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 341,\n          columnNumber: 13\n        }, this), video_icon === true ? /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: togglestream,\n          id: \"mute-icon\",\n          className: \"video_chat_icons\",\n          children: /*#__PURE__*/_jsxDEV(\"i\", {\n            class: \"fa fa-video\",\n            style: {\n              fontSize: \"24px\",\n              color: \"red\"\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 358,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 353,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: togglestream,\n          id: \"unmute-icon\",\n          className: \"video_chat_icons\",\n          children: /*#__PURE__*/_jsxDEV(\"i\", {\n            class: \"fa fa-video-slash\",\n            style: {\n              fontSize: \"24px\",\n              color: \"red\"\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 369,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 364,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: screenshare,\n          id: \"screen-icon\",\n          className: \"video_chat_icons\",\n          children: /*#__PURE__*/_jsxDEV(\"i\", {\n            class: \"fa fa-tv\",\n            style: {\n              fontSize: \"24px\",\n              color: \"red\"\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 380,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 375,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"username\",\n          children: username\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 382,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 326,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        id: \"video-grid\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 385,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 325,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 323,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Videochatroom, \"WsRscbd4S5WNg6gjHJ3/N2PUN3Y=\");\n\n_c = Videochatroom;\nexport default _c2 = withRouter(Videochatroom);\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"Videochatroom\");\n$RefreshReg$(_c2, \"%default%\");","map":{"version":3,"sources":["E:/video_project/client/src/Components/Videochatroom.js"],"names":["React","useState","useEffect","io","withRouter","Peer","Videochatroom","props","socket","setSocket","peers","addpeers","mypeerID","setmypeerID","mypeer","setmypeer","mystreams","setmystream","mute","setmute","video_icon","setvideo_icon","screenshare_icon","setscreenshare_icon","username","setusername","document","getElementById","style","visibility","myPeer","undefined","host","port","mystream","console","log","match","params","id","userName","localStorage","getItem","newsocket","connect","query","roomId","setsocket","on","emit","myVideo","muted","navigator","mediaDevices","getUserMedia","video","audio","then","stream","addVideoStream","data","setTimeout","connectToNewUser","userId","disconnectedVideo","userdiv","remove","close","peervideo","peerid","srcObject","tracks","getTracks","forEach","track","kind","stop","call","answer","memberid","peer","play","createElement","receivedusername","userVideoStream","removeAllListeners","readyState","disconnect","display","prevstate","className","div","videoGrid","addEventListener","append","span","fullscreen","innerHTML","alert","x","muteunmute","v","togglestream","myvideo","src","screenshare","getDisplayMedia","fontSize","color"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { io } from \"socket.io-client\";\r\nimport { withRouter } from \"react-router-dom\";\r\nimport Peer from \"peerjs\";\r\n\r\n//import { validate as uuidValidate } from \"uuid\";\r\n\r\nconst Videochatroom = (props) => {\r\n  // let socketInstance = useRef(null);\r\n\r\n  const [socket, setSocket] = useState(null);\r\n  const [peers, addpeers] = useState({});\r\n  const [mypeerID, setmypeerID] = useState(\"\");\r\n  const [mypeer, setmypeer] = useState(\"\");\r\n  const [mystreams, setmystream] = useState(\"\");\r\n  const [mute, setmute] = useState(true);\r\n  const [video_icon, setvideo_icon] = useState(true);\r\n  const [screenshare_icon, setscreenshare_icon] = useState(false);\r\n  const [username, setusername] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    document.getElementById(\"comment-icon\").style.visibility = \"visible\";\r\n    const myPeer = new Peer(undefined, {\r\n      host: \"/\",\r\n      port: \"3008\",\r\n    });\r\n    setmypeer(myPeer);\r\n    let mystream = \"\";\r\n    //setmypeer(myPeer);\r\n\r\n    console.log(props.match.params.id);\r\n    console.log(\"mount it using useEffect!\");\r\n\r\n    const userName = localStorage.getItem(\"userName\");\r\n    setusername(userName);\r\n    const newsocket = io.connect(\"http://localhost:4000\", {\r\n      query: {\r\n        roomId: props.match.params.id,\r\n        userName,\r\n      },\r\n    });\r\n    console.log(\"socket id \" + newsocket.id);\r\n    setSocket(newsocket);\r\n    props.setsocket(newsocket);\r\n\r\n    myPeer.on(\"open\", (id) => {\r\n      console.log(\"user id send to join room \" + id);\r\n\r\n      setmypeerID(id);\r\n      newsocket.emit(\"join-room\", id);\r\n    });\r\n\r\n    const myVideo = document.getElementById(\"myvideo\");\r\n    myVideo.muted = true;\r\n\r\n    console.log(\"alright now \");\r\n    navigator.mediaDevices\r\n      .getUserMedia({\r\n        video: true,\r\n        audio: true,\r\n      })\r\n      .then((stream) => {\r\n        mystream = stream;\r\n        setmystream(stream);\r\n        addVideoStream(myVideo, stream);\r\n\r\n        newsocket.on(\"user-connected\", (data) => {\r\n          console.log(\"user id received of new user\" + data.id + data.username);\r\n          setTimeout(connectToNewUser, 1000, data, stream, myPeer, newsocket);\r\n          // connectToNewUser(userId, stream, myPeer);\r\n        });\r\n        newsocket.on(\"user-disconnected\", (userId) => {\r\n          console.log(\"userid disconnected \" + userId);\r\n          const disconnectedVideo = document.getElementById(userId);\r\n          const userdiv = document.getElementById(userId + \"a\");\r\n          if (userId) {\r\n            disconnectedVideo.remove();\r\n\r\n            userdiv.remove();\r\n          }\r\n\r\n          if (peers[userId]) peers[userId].close();\r\n        });\r\n        newsocket.on(\"mute-unmute\", (data) => {\r\n          if (data.id != myPeer.id) {\r\n            const peervideo = document.getElementById(data.id);\r\n            if (data.mute) peervideo.muted = true;\r\n            else peervideo.muted = false;\r\n          }\r\n        });\r\n        newsocket.on(\"togglestream\", (peerid) => {\r\n          if (peerid != myPeer.id) {\r\n            console.log(\"togglestream\");\r\n            const peervideo = document.getElementById(peerid);\r\n            const stream = peervideo.srcObject;\r\n            const tracks = stream.getTracks();\r\n            tracks.forEach((track) => {\r\n              if (track.kind == \"video\") {\r\n                track.stop();\r\n              }\r\n            });\r\n          }\r\n        });\r\n\r\n        myPeer.on(\"call\", (call) => {\r\n          console.log(\"someone calling\");\r\n          call.answer(stream);\r\n          const memberid = document.getElementById(call.peer);\r\n          let video = \"\";\r\n          if (memberid != null) {\r\n            console.log(\"member if not null \");\r\n            video = memberid;\r\n            video.muted = true;\r\n            call.on(\"stream\", (stream) => {\r\n              video.srcObject = stream;\r\n              video.play();\r\n            });\r\n            call.on(\"close\", () => {\r\n              console.log(\"call closing\");\r\n              myVideo.remove();\r\n            });\r\n          } else {\r\n            video = document.createElement(\"video\");\r\n            console.log(\"call.peer \" + call.peer);\r\n            video.id = call.peer;\r\n            video.muted = true;\r\n            let receivedusername = \"\";\r\n            newsocket.emit(\"getUsername\", call.peer);\r\n            newsocket.on(\"getUsername\", (data) => {\r\n              receivedusername = data;\r\n              console.log(\"getusername received call \" + receivedusername);\r\n            });\r\n\r\n            call.on(\"stream\", (userVideoStream) => {\r\n              addVideoStream(video, userVideoStream, receivedusername);\r\n            });\r\n\r\n            call.on(\"close\", () => {\r\n              console.log(\"call closing\");\r\n              myVideo.remove();\r\n            });\r\n          }\r\n        });\r\n      });\r\n\r\n    // return works like component will unmount\r\n    return () => {\r\n      newsocket.emit(\"user-disconnected\", myPeer.id);\r\n      newsocket.removeAllListeners();\r\n\r\n      mystream.getTracks().forEach(function (track) {\r\n        if (track.readyState == \"live\") {\r\n          track.stop();\r\n        }\r\n      });\r\n      myPeer.disconnect();\r\n      document.getElementById(\"comment-icon\").style.visibility = \"hidden\";\r\n      document.getElementById(\"chatbox\").style.display = \"none\";\r\n    };\r\n  }, []);\r\n\r\n  const connectToNewUser = async (data, stream, myPeer, socket) => {\r\n    console.log(\"connecting to newuser! \" + data.username);\r\n    // socket.emit(\"getUsername\");\r\n    const call = await myPeer.call(data.id, stream);\r\n\r\n    // adding peers flush updates\r\n    console.log(\"peers adding \");\r\n    addpeers((prevstate) => ({\r\n      ...prevstate,\r\n      [data.id]: call,\r\n    }));\r\n\r\n    const video = document.createElement(\"video\");\r\n    video.id = data.id;\r\n    video.className = \"peer-videos\";\r\n    video.muted = true;\r\n    console.log(\"cALL \" + call + \"peer \" + myPeer.id);\r\n    if (call === null || call === \"\" || call === undefined) console.log(\"null\");\r\n\r\n    await call.on(\"stream\", (userVideoStream) => {\r\n      console.log(\"streaming \");\r\n      addVideoStream(video, userVideoStream, data.username);\r\n    });\r\n  };\r\n\r\n  const addVideoStream = async (video, stream, username = \"\") => {\r\n    console.log(\"adding video stream with id \", video.id);\r\n    let div;\r\n\r\n    const videoGrid = document.getElementById(\"video-grid\");\r\n\r\n    video.srcObject = stream;\r\n    await video.addEventListener(\"loadedmetadata\", () => {\r\n      if (video.id != \"myvideo\") {\r\n        div = document.createElement(\"div\");\r\n        div.className = \"self-video\";\r\n        div.id = video.id + \"a\";\r\n        div.append(video);\r\n\r\n        const span = document.createElement(\"span\");\r\n        const fullscreen = document.createElement(\"span\");\r\n        span.className = \"username\";\r\n        span.innerHTML = username;\r\n        fullscreen.innerHTML = \"fullscreen\";\r\n        fullscreen.id = \"fullscreen\";\r\n        fullscreen.addEventListener(\"click\", () => {\r\n          alert(\"hi\");\r\n        });\r\n        div.append(span);\r\n        div.append(fullscreen);\r\n      }\r\n      video.play();\r\n      if (video.id === \"myvideo\") {\r\n      } else {\r\n        div.className = \"notself-video\";\r\n        const x = document.getElementById(video.id + \"a\");\r\n        if (x != null) {\r\n          console.log(\"removing div\");\r\n          x.remove();\r\n        }\r\n        videoGrid.append(div);\r\n      }\r\n    });\r\n\r\n    console.log(\":appending\");\r\n  };\r\n\r\n  const muteunmute = () => {\r\n    const v = document.getElementById(\"myvideo\");\r\n    const data = {\r\n      id: mypeerID,\r\n    };\r\n    if (v.muted) {\r\n      v.muted = false;\r\n      data.mute = false;\r\n      setmute(false);\r\n    } else {\r\n      v.muted = true;\r\n      data.mute = true;\r\n      setmute(true);\r\n    }\r\n    console.log(\"mute \" + mypeerID);\r\n\r\n    socket.emit(\"mute-unmute\", data);\r\n  };\r\n  const togglestream = () => {\r\n    console.log(\"video icon value \" + video_icon);\r\n    const myvideo = document.getElementById(\"myvideo\");\r\n    mystreams.getTracks().forEach((track) => {\r\n      if (track.kind === \"video\") {\r\n        if (track.readyState == \"live\") {\r\n          console.log(\":true \");\r\n          track.stop();\r\n          setvideo_icon(false);\r\n          myvideo.src = \"\";\r\n          myvideo.srcObject = null;\r\n          socket.emit(\"togglestream\", mypeerID);\r\n        } else {\r\n          console.log(\":false\");\r\n          navigator.mediaDevices\r\n            .getUserMedia({\r\n              video: true,\r\n              audio: true,\r\n            })\r\n            .then((stream) => {\r\n              setmystream(stream);\r\n              const video = document.getElementById(\"myvideo\");\r\n              video.srcObject = stream;\r\n              video.addEventListener(\"loadedmetadata\", () => {\r\n                video.play();\r\n              });\r\n              socket.emit(\"getPeers\");\r\n              socket.on(\"getPeers\", (peers) => {\r\n                peers.forEach((peer) => {\r\n                  mypeer.call(peer, stream);\r\n                });\r\n              });\r\n            });\r\n          setvideo_icon(true);\r\n        }\r\n      }\r\n    });\r\n  };\r\n  const screenshare = () => {\r\n    const myvideo = document.getElementById(\"myvideo\");\r\n    if (video_icon == true || screenshare_icon == true) {\r\n      mystreams.getTracks().forEach((track) => {\r\n        if (track.kind === \"video\") {\r\n          if (track.readyState == \"live\") {\r\n            console.log(\":true \");\r\n            track.stop();\r\n            setvideo_icon(false);\r\n            myvideo.src = \"\";\r\n            myvideo.srcObject = null;\r\n            socket.emit(\"togglestream\", mypeerID);\r\n          }\r\n        }\r\n      });\r\n    }\r\n    if (screenshare_icon == false) {\r\n      navigator.mediaDevices\r\n        .getDisplayMedia({\r\n          video: true,\r\n        })\r\n        .then((stream) => {\r\n          setmystream(stream);\r\n          setscreenshare_icon(true);\r\n          const video = document.getElementById(\"myvideo\");\r\n          video.srcObject = stream;\r\n          socket.emit(\"getPeers\");\r\n          socket.on(\"getPeers\", (peers) => {\r\n            peers.forEach((peer) => {\r\n              mypeer.call(peer, stream);\r\n            });\r\n          });\r\n        });\r\n    } else {\r\n      setscreenshare_icon(false);\r\n    }\r\n  };\r\n  return (\r\n    <div>\r\n      <h2>PEERS</h2>\r\n      <div className=\"video-main\">\r\n        <div class=\"self-video\">\r\n          <video id=\"myvideo\" />\r\n\r\n          {mute === true ? (\r\n            <button\r\n              onClick={muteunmute}\r\n              id=\"mute-icon\"\r\n              className=\"video_chat_icons\"\r\n            >\r\n              <i\r\n                class=\"fas fa-microphone-slash\"\r\n                style={{ fontSize: \"24px\", color: \"red\" }}\r\n              />\r\n            </button>\r\n          ) : (\r\n            <button\r\n              onClick={muteunmute}\r\n              id=\"unmute-icon\"\r\n              className=\"video_chat_icons\"\r\n            >\r\n              <i\r\n                class=\"fas fa-microphone\"\r\n                style={{ fontSize: \"24px\", color: \"red\" }}\r\n              />\r\n            </button>\r\n          )}\r\n          {video_icon === true ? (\r\n            <button\r\n              onClick={togglestream}\r\n              id=\"mute-icon\"\r\n              className=\"video_chat_icons\"\r\n            >\r\n              <i\r\n                class=\"fa fa-video\"\r\n                style={{ fontSize: \"24px\", color: \"red\" }}\r\n              />\r\n            </button>\r\n          ) : (\r\n            <button\r\n              onClick={togglestream}\r\n              id=\"unmute-icon\"\r\n              className=\"video_chat_icons\"\r\n            >\r\n              <i\r\n                class=\"fa fa-video-slash\"\r\n                style={{ fontSize: \"24px\", color: \"red\" }}\r\n              />\r\n            </button>\r\n          )}\r\n          <button\r\n            onClick={screenshare}\r\n            id=\"screen-icon\"\r\n            className=\"video_chat_icons\"\r\n          >\r\n            <i class=\"fa fa-tv\" style={{ fontSize: \"24px\", color: \"red\" }} />\r\n          </button>\r\n          <span className=\"username\">{username}</span>\r\n        </div>\r\n\r\n        <div id=\"video-grid\"></div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\nexport default withRouter(Videochatroom);\r\n"]},"metadata":{},"sourceType":"module"}