{"ast":null,"code":"var _jsxFileName = \"E:\\\\video_project\\\\client\\\\src\\\\Components\\\\Videochatroom.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from \"react\";\nimport { io } from \"socket.io-client\";\nimport { withRouter } from \"react-router-dom\";\nimport Peer from \"peerjs\"; //import { validate as uuidValidate } from \"uuid\";\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst Videochatroom = props => {\n  _s();\n\n  // let socketInstance = useRef(null);\n  const [socket, setSocket] = useState(null);\n  const [peers, addpeers] = useState({});\n  const [mypeerID, setmypeerID] = useState(\"\");\n  const [mystreams, setmystream] = useState(\"\");\n  const [mute, setmute] = useState(true);\n  const [video_icon, setvideo_icon] = useState(true);\n  useEffect(() => {\n    let mystream = \"\";\n    setmypeerID(props.myPeer.id);\n    setSocket(props.newsocket);\n    props.newsocket.emit(\"join-room\", props.myPeer.id);\n    const myVideo = document.getElementById(\"myvideo\");\n    myVideo.muted = true;\n    console.log(\"alright now \");\n    navigator.mediaDevices.getUserMedia({\n      video: true,\n      audio: true\n    }).then(stream => {\n      console.log(\"again\");\n      mystream = stream;\n      setmystream(stream);\n      addVideoStream(myVideo, stream);\n      props.newsocket.on(\"user-connected\", userId => {\n        console.log(\"user id received of new user\" + userId);\n        setTimeout(connectToNewUser, 1000, userId, stream, props.myPeer); // connectToNewUser(userId, stream, myPeer);\n      });\n      props.newsocket.on(\"user-disconnected\", userId => {\n        console.log(\"userid disconnected \" + userId);\n        const disconnectedVideo = document.getElementById(userId);\n\n        if (userId) {\n          disconnectedVideo.remove();\n        }\n\n        if (peers[userId]) peers[userId].close();\n      });\n      props.newsocket.on(\"mute-unmute\", data => {\n        if (data.id != props.myPeer.id) {\n          console.log(\"dataid \" + data.id + \"props.id \" + props.myPeer.id);\n          const peervideo = document.getElementById(data.id);\n          if (data.mute) peervideo.muted = true;else peervideo.muted = false;\n        }\n      });\n      props.myPeer.on(\"call\", call => {\n        console.log(\"someone calling\");\n        call.answer(stream);\n        const video = document.createElement(\"video\");\n        console.log(\"call.peer \" + call.peer);\n        video.id = call.peer;\n        video.muted = true;\n        call.on(\"stream\", userVideoStream => {\n          addVideoStream(video, userVideoStream);\n        });\n        call.on(\"close\", () => {\n          console.log(\"call closing\");\n          myVideo.remove();\n        });\n      });\n    }); // return works like component will unmount\n\n    return () => {\n      console.log(\"return\");\n      mystream.getTracks().forEach(function (track) {\n        if (track.readyState == \"live\") {\n          track.stop();\n        }\n      });\n    };\n  }, []);\n\n  const connectToNewUser = async (userId, stream, myPeer) => {\n    console.log(\"connecting to newuser! \");\n    const call = await myPeer.call(userId, stream);\n    call.on(\"error\", error => {\n      console.log(error);\n    }); // adding peers flush updates\n\n    console.log(\"peers adding \");\n    addpeers(prevstate => ({ ...prevstate,\n      [userId]: call\n    }));\n    const video = document.createElement(\"video\");\n    video.id = userId;\n    video.className = \"peer-videos\";\n    video.muted = true;\n    console.log(\"cALL \" + call + \"peer \" + myPeer.id);\n    if (call === null || call === \"\" || call === undefined) console.log(\"null\");\n    await call.on(\"stream\", userVideoStream => {\n      console.log(\"streaming \");\n      addVideoStream(video, userVideoStream);\n    });\n  };\n\n  const addVideoStream = (video, stream) => {\n    console.log(\"adding video stream with id \", video.id);\n    const videoGrid = document.getElementById(\"video-grid\");\n    video.srcObject = stream;\n    video.addEventListener(\"loadedmetadata\", () => {\n      video.play();\n    });\n\n    if (video.id === \"myvideo\") {} else {\n      videoGrid.append(video);\n    }\n\n    console.log(\":appending\");\n  };\n\n  const muteunmute = () => {\n    const v = document.getElementById(\"myvideo\");\n    const data = {\n      id: mypeerID\n    };\n\n    if (v.muted) {\n      v.muted = false;\n      data.mute = false;\n      setmute(false);\n    } else {\n      v.muted = true;\n      data.mute = true;\n      setmute(true);\n    }\n\n    console.log(\"mute \" + mypeerID);\n    socket.emit(\"mute-unmute\", data);\n  };\n\n  const togglestream = () => {\n    console.log(\"video icon value \" + video_icon);\n    mystreams.getTracks().forEach(track => {\n      if (track.kind === \"video\") {\n        if (track.readyState == \"live\") {\n          console.log(\":true \");\n          track.stop();\n          setvideo_icon(false);\n        } else {\n          console.log(\":false\");\n          navigator.mediaDevices.getUserMedia({\n            video: true,\n            audio: true\n          }).then(stream => {\n            setmystream(stream);\n            const video = document.getElementById(\"myvideo\");\n            video.srcObject = stream;\n            video.addEventListener(\"loadedmetadata\", () => {\n              video.play();\n            });\n          });\n          setvideo_icon(true);\n        }\n      }\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"video-main\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      class: \"self-video\",\n      children: [/*#__PURE__*/_jsxDEV(\"video\", {\n        id: \"myvideo\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 188,\n        columnNumber: 9\n      }, this), mute === true ? /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: muteunmute,\n        id: \"mute-icon\",\n        className: \"video_chat_icons\",\n        children: /*#__PURE__*/_jsxDEV(\"i\", {\n          class: \"fas fa-microphone-slash\",\n          style: {\n            fontSize: \"24px\",\n            color: \"red\"\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 196,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 191,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: muteunmute,\n        id: \"unmute-icon\",\n        className: \"video_chat_icons\",\n        children: /*#__PURE__*/_jsxDEV(\"i\", {\n          class: \"fas fa-microphone\",\n          style: {\n            fontSize: \"24px\",\n            color: \"red\"\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 207,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 11\n      }, this), video_icon === true ? /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: togglestream,\n        id: \"mute-icon\",\n        className: \"video_chat_icons\",\n        children: /*#__PURE__*/_jsxDEV(\"i\", {\n          class: \"fa fa-video\",\n          style: {\n            fontSize: \"24px\",\n            color: \"red\"\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 219,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 214,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: togglestream,\n        id: \"unmute-icon\",\n        className: \"video_chat_icons\",\n        children: /*#__PURE__*/_jsxDEV(\"i\", {\n          class: \"fa fa-video-slash\",\n          style: {\n            fontSize: \"24px\",\n            color: \"red\"\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 227,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 222,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"video-grid\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 186,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Videochatroom, \"gH4W/z4Jndn8YsIyQ4Rbpoz0Tc8=\");\n\n_c = Videochatroom;\nexport default _c2 = withRouter(Videochatroom);\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"Videochatroom\");\n$RefreshReg$(_c2, \"%default%\");","map":{"version":3,"sources":["E:/video_project/client/src/Components/Videochatroom.js"],"names":["React","useState","useEffect","io","withRouter","Peer","Videochatroom","props","socket","setSocket","peers","addpeers","mypeerID","setmypeerID","mystreams","setmystream","mute","setmute","video_icon","setvideo_icon","mystream","myPeer","id","newsocket","emit","myVideo","document","getElementById","muted","console","log","navigator","mediaDevices","getUserMedia","video","audio","then","stream","addVideoStream","on","userId","setTimeout","connectToNewUser","disconnectedVideo","remove","close","data","peervideo","call","answer","createElement","peer","userVideoStream","getTracks","forEach","track","readyState","stop","error","prevstate","className","undefined","videoGrid","srcObject","addEventListener","play","append","muteunmute","v","togglestream","kind","fontSize","color"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { io } from \"socket.io-client\";\r\nimport { withRouter } from \"react-router-dom\";\r\nimport Peer from \"peerjs\";\r\n\r\n//import { validate as uuidValidate } from \"uuid\";\r\n\r\nconst Videochatroom = (props) => {\r\n  // let socketInstance = useRef(null);\r\n\r\n  const [socket, setSocket] = useState(null);\r\n  const [peers, addpeers] = useState({});\r\n  const [mypeerID, setmypeerID] = useState(\"\");\r\n  const [mystreams, setmystream] = useState(\"\");\r\n  const [mute, setmute] = useState(true);\r\n  const [video_icon, setvideo_icon] = useState(true);\r\n\r\n  useEffect(() => {\r\n    let mystream = \"\";\r\n    setmypeerID(props.myPeer.id);\r\n\r\n    setSocket(props.newsocket);\r\n\r\n    props.newsocket.emit(\"join-room\", props.myPeer.id);\r\n\r\n    const myVideo = document.getElementById(\"myvideo\");\r\n    myVideo.muted = true;\r\n\r\n    console.log(\"alright now \");\r\n    navigator.mediaDevices\r\n      .getUserMedia({\r\n        video: true,\r\n        audio: true,\r\n      })\r\n      .then((stream) => {\r\n        console.log(\"again\");\r\n        mystream = stream;\r\n        setmystream(stream);\r\n        addVideoStream(myVideo, stream);\r\n\r\n        props.newsocket.on(\"user-connected\", (userId) => {\r\n          console.log(\"user id received of new user\" + userId);\r\n          setTimeout(connectToNewUser, 1000, userId, stream, props.myPeer);\r\n          // connectToNewUser(userId, stream, myPeer);\r\n        });\r\n        props.newsocket.on(\"user-disconnected\", (userId) => {\r\n          console.log(\"userid disconnected \" + userId);\r\n          const disconnectedVideo = document.getElementById(userId);\r\n          if (userId) {\r\n            disconnectedVideo.remove();\r\n          }\r\n\r\n          if (peers[userId]) peers[userId].close();\r\n        });\r\n        props.newsocket.on(\"mute-unmute\", (data) => {\r\n          if (data.id != props.myPeer.id) {\r\n            console.log(\"dataid \" + data.id + \"props.id \" + props.myPeer.id);\r\n            const peervideo = document.getElementById(data.id);\r\n            if (data.mute) peervideo.muted = true;\r\n            else peervideo.muted = false;\r\n          }\r\n        });\r\n\r\n        props.myPeer.on(\"call\", (call) => {\r\n          console.log(\"someone calling\");\r\n\r\n          call.answer(stream);\r\n          const video = document.createElement(\"video\");\r\n          console.log(\"call.peer \" + call.peer);\r\n          video.id = call.peer;\r\n          video.muted = true;\r\n\r\n          call.on(\"stream\", (userVideoStream) => {\r\n            addVideoStream(video, userVideoStream);\r\n          });\r\n\r\n          call.on(\"close\", () => {\r\n            console.log(\"call closing\");\r\n            myVideo.remove();\r\n          });\r\n        });\r\n      });\r\n\r\n    // return works like component will unmount\r\n    return () => {\r\n      console.log(\"return\");\r\n      mystream.getTracks().forEach(function (track) {\r\n        if (track.readyState == \"live\") {\r\n          track.stop();\r\n        }\r\n      });\r\n    };\r\n  }, []);\r\n\r\n  const connectToNewUser = async (userId, stream, myPeer) => {\r\n    console.log(\"connecting to newuser! \");\r\n    const call = await myPeer.call(userId, stream);\r\n\r\n    call.on(\"error\", (error) => {\r\n      console.log(error);\r\n    });\r\n    // adding peers flush updates\r\n    console.log(\"peers adding \");\r\n    addpeers((prevstate) => ({\r\n      ...prevstate,\r\n      [userId]: call,\r\n    }));\r\n\r\n    const video = document.createElement(\"video\");\r\n    video.id = userId;\r\n    video.className = \"peer-videos\";\r\n    video.muted = true;\r\n    console.log(\"cALL \" + call + \"peer \" + myPeer.id);\r\n    if (call === null || call === \"\" || call === undefined) console.log(\"null\");\r\n\r\n    await call.on(\"stream\", (userVideoStream) => {\r\n      console.log(\"streaming \");\r\n      addVideoStream(video, userVideoStream);\r\n    });\r\n  };\r\n\r\n  const addVideoStream = (video, stream) => {\r\n    console.log(\"adding video stream with id \", video.id);\r\n\r\n    const videoGrid = document.getElementById(\"video-grid\");\r\n    video.srcObject = stream;\r\n    video.addEventListener(\"loadedmetadata\", () => {\r\n      video.play();\r\n    });\r\n    if (video.id === \"myvideo\") {\r\n    } else {\r\n      videoGrid.append(video);\r\n    }\r\n\r\n    console.log(\":appending\");\r\n  };\r\n\r\n  const muteunmute = () => {\r\n    const v = document.getElementById(\"myvideo\");\r\n    const data = {\r\n      id: mypeerID,\r\n    };\r\n    if (v.muted) {\r\n      v.muted = false;\r\n      data.mute = false;\r\n      setmute(false);\r\n    } else {\r\n      v.muted = true;\r\n      data.mute = true;\r\n      setmute(true);\r\n    }\r\n    console.log(\"mute \" + mypeerID);\r\n\r\n    socket.emit(\"mute-unmute\", data);\r\n  };\r\n  const togglestream = () => {\r\n    console.log(\"video icon value \" + video_icon);\r\n    mystreams.getTracks().forEach((track) => {\r\n      if (track.kind === \"video\") {\r\n        if (track.readyState == \"live\") {\r\n          console.log(\":true \");\r\n          track.stop();\r\n          setvideo_icon(false);\r\n        } else {\r\n          console.log(\":false\");\r\n          navigator.mediaDevices\r\n            .getUserMedia({\r\n              video: true,\r\n              audio: true,\r\n            })\r\n            .then((stream) => {\r\n              setmystream(stream);\r\n              const video = document.getElementById(\"myvideo\");\r\n              video.srcObject = stream;\r\n              video.addEventListener(\"loadedmetadata\", () => {\r\n                video.play();\r\n              });\r\n            });\r\n          setvideo_icon(true);\r\n        }\r\n      }\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div className=\"video-main\">\r\n      <div class=\"self-video\">\r\n        <video id=\"myvideo\" />\r\n\r\n        {mute === true ? (\r\n          <button\r\n            onClick={muteunmute}\r\n            id=\"mute-icon\"\r\n            className=\"video_chat_icons\"\r\n          >\r\n            <i\r\n              class=\"fas fa-microphone-slash\"\r\n              style={{ fontSize: \"24px\", color: \"red\" }}\r\n            />\r\n          </button>\r\n        ) : (\r\n          <button\r\n            onClick={muteunmute}\r\n            id=\"unmute-icon\"\r\n            className=\"video_chat_icons\"\r\n          >\r\n            <i\r\n              class=\"fas fa-microphone\"\r\n              style={{ fontSize: \"24px\", color: \"red\" }}\r\n            />\r\n          </button>\r\n        )}\r\n        {video_icon === true ? (\r\n          <button\r\n            onClick={togglestream}\r\n            id=\"mute-icon\"\r\n            className=\"video_chat_icons\"\r\n          >\r\n            <i class=\"fa fa-video\" style={{ fontSize: \"24px\", color: \"red\" }} />\r\n          </button>\r\n        ) : (\r\n          <button\r\n            onClick={togglestream}\r\n            id=\"unmute-icon\"\r\n            className=\"video_chat_icons\"\r\n          >\r\n            <i\r\n              class=\"fa fa-video-slash\"\r\n              style={{ fontSize: \"24px\", color: \"red\" }}\r\n            />\r\n          </button>\r\n        )}\r\n      </div>\r\n      <div id=\"video-grid\"></div>\r\n    </div>\r\n  );\r\n};\r\nexport default withRouter(Videochatroom);\r\n"]},"metadata":{},"sourceType":"module"}