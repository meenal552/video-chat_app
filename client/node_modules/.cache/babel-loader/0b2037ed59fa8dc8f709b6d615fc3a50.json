{"ast":null,"code":"var _jsxFileName = \"E:\\\\video_project\\\\client\\\\src\\\\Components\\\\JoinRoom.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from \"react\";\nimport { io } from \"socket.io-client\";\nimport { withRouter } from \"react-router-dom\"; //import createSocketConnectionInstance from \"./Connection\"\n\nimport Peer from \"peerjs\"; //import { validate as uuidValidate } from \"uuid\";\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function JoinRoom(props) {\n  _s();\n\n  // let socketInstance = useRef(null);\n  const [socket, setSocket] = useState(\"\");\n  const myPeer = new Peer(undefined, {\n    host: \"/\",\n    port: \"3001\"\n  });\n  useEffect(() => {\n    console.log(props.match.params.id);\n    console.log(\"mount it using useEffect!\");\n    const newsocket = io.connect(\"http://localhost:4000\", {\n      query: {\n        roomId: props.match.params.id\n      }\n    });\n    setSocket(newsocket);\n  }, []);\n\n  const startVideo = () => {\n    console.log(\"video started \");\n    const myVideo = document.createElement(\"video\");\n    myVideo.muted = true;\n    const peers = {};\n    console.log(\"alright now \");\n    navigator.mediaDevices.getUserMedia({\n      video: true,\n      audio: true\n    }).then(stream => {\n      addVideoStream(myVideo, stream);\n      myPeer.on(\"call\", call => {\n        call.answer(stream);\n        const video = document.createElement(\"video\");\n        call.on(\"stream\", userVideoStream => {\n          addVideoStream(video, userVideoStream);\n        });\n      });\n      socket.on(\"user-connected\", userId => {\n        connectToNewUser(userId, stream);\n      });\n    });\n    socket.on(\"user-disconnected\", userId => {\n      if (peers[userId]) peers[userId].close();\n    });\n    myPeer.on(\"open\", id => {\n      socket.emit(\"join-room\", id);\n    });\n\n    function connectToNewUser(userId, stream) {\n      console.log(\"connecting to user \");\n      const call = myPeer.call(userId, stream);\n      const video = document.createElement(\"video\");\n      call.on(\"stream\", userVideoStream => {\n        addVideoStream(video, userVideoStream);\n      });\n      call.on(\"close\", () => {\n        video.remove();\n      });\n      peers[userId] = call;\n    }\n\n    function addVideoStream(video, stream) {\n      console.log(\"adding video stream\");\n      const videoGrid = document.getElementById(\"video-grid\");\n      video.srcObject = stream;\n      video.addEventListener(\"loadedmetadata\", () => {\n        video.play();\n      });\n      videoGrid.append(video);\n    }\n  };\n\n  return withRouter( /*#__PURE__*/_jsxDEV(\"div\", {\n    id: \"video-grid\",\n    children: [/*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"hello there \"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: startVideo,\n      children: \"start video chat\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"video\", {\n      children: \"Start streaming\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 92,\n    columnNumber: 5\n  }, this));\n}\n\n_s(JoinRoom, \"+KmEKAfgWEP+a4Dqy0QXoARB+yc=\");\n\n_c = JoinRoom;\n\nvar _c;\n\n$RefreshReg$(_c, \"JoinRoom\");","map":{"version":3,"sources":["E:/video_project/client/src/Components/JoinRoom.js"],"names":["React","useState","useEffect","io","withRouter","Peer","JoinRoom","props","socket","setSocket","myPeer","undefined","host","port","console","log","match","params","id","newsocket","connect","query","roomId","startVideo","myVideo","document","createElement","muted","peers","navigator","mediaDevices","getUserMedia","video","audio","then","stream","addVideoStream","on","call","answer","userVideoStream","userId","connectToNewUser","close","emit","remove","videoGrid","getElementById","srcObject","addEventListener","play","append"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { io } from \"socket.io-client\";\r\nimport { withRouter } from \"react-router-dom\";\r\n//import createSocketConnectionInstance from \"./Connection\"\r\nimport Peer from \"peerjs\";\r\n//import { validate as uuidValidate } from \"uuid\";\r\n\r\nexport default function JoinRoom(props) {\r\n  // let socketInstance = useRef(null);\r\n  const [socket, setSocket] = useState(\"\");\r\n\r\n  const myPeer = new Peer(undefined, {\r\n    host: \"/\",\r\n    port: \"3001\",\r\n  });\r\n\r\n  useEffect(() => {\r\n    console.log(props.match.params.id);\r\n    console.log(\"mount it using useEffect!\");\r\n    const newsocket = io.connect(\"http://localhost:4000\", {\r\n      query: {\r\n        roomId: props.match.params.id,\r\n      },\r\n    });\r\n    setSocket(newsocket);\r\n  }, []);\r\n\r\n  const startVideo = () => {\r\n    console.log(\"video started \");\r\n\r\n    const myVideo = document.createElement(\"video\");\r\n    myVideo.muted = true;\r\n    const peers = {};\r\n  console.log(\"alright now \");\r\n    navigator.mediaDevices\r\n      .getUserMedia({\r\n        video: true,\r\n        audio: true,\r\n      })\r\n      .then((stream) => {\r\n        addVideoStream(myVideo, stream);\r\n\r\n        myPeer.on(\"call\", (call) => {\r\n          call.answer(stream);\r\n          const video = document.createElement(\"video\");\r\n          call.on(\"stream\", (userVideoStream) => {\r\n            addVideoStream(video, userVideoStream);\r\n          });\r\n        });\r\n\r\n        socket.on(\"user-connected\", (userId) => {\r\n          connectToNewUser(userId, stream);\r\n        });\r\n      });\r\n\r\n    socket.on(\"user-disconnected\", (userId) => {\r\n      if (peers[userId]) peers[userId].close();\r\n    });\r\n\r\n    myPeer.on(\"open\", (id) => {\r\n      socket.emit(\"join-room\", id);\r\n    });\r\n\r\n    function connectToNewUser(userId, stream) {\r\n      console.log(\"connecting to user \");\r\n      const call = myPeer.call(userId, stream);\r\n      const video = document.createElement(\"video\");\r\n      call.on(\"stream\", (userVideoStream) => {\r\n        addVideoStream(video, userVideoStream);\r\n      });\r\n      call.on(\"close\", () => {\r\n        video.remove();\r\n      });\r\n\r\n      peers[userId] = call;\r\n    }\r\n\r\n    function addVideoStream(video, stream) {\r\n      console.log(\"adding video stream\");\r\n      const videoGrid = document.getElementById(\"video-grid\");\r\n      video.srcObject = stream;\r\n      video.addEventListener(\"loadedmetadata\", () => {\r\n        video.play();\r\n      });\r\n      videoGrid.append(video);\r\n    }\r\n  };\r\n\r\n  \r\n\r\n  return withRouter (\r\n    <div id=\"video-grid\">\r\n      <p>hello there </p>\r\n      <button onClick={startVideo}>start video chat</button>\r\n      <video >Start streaming</video>\r\n    </div>\r\n  );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}